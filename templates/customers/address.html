{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Button trigger modal -->

  

  <!-- Body-->
  <body class="handheld-toolbar-enabled">
   
    <main class="page-wrapper">
      <!-- Add New Address-->
      <form class="needs-validation modal fade" id="add-address" tabindex="-1" method="POST" novalidate>
        {% csrf_token %}
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add a new address</h5>
              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row gx-4 gy-3">
                <div class="col-sm-6">
                  <label class="form-label" for="address-fn">First name</label>
                  <input class="form-control" type="text" id="address-fn" name="first_name" required>
                  <div class="invalid-feedback">Please fill in you first name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-fn">Last name</label>
                  <input class="form-control" type="text" id="address-fn" name="last_name" required>
                  <div class="invalid-feedback">Please fill in you last name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-line1">Address Line 1</label>
                  <input class="form-control" type="text" id="address-line1" name="address_line_1" required>
                  <div class="invalid-feedback">Please fill in your address!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-line2">Unit No</label>
                  <input class="form-control" type="text" id="address-line2" name="unit_no">
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">Country</label>
                  <input class="form-control" type="text" id="address-country" name="country"  required>
                  <div class="invalid-feedback">Please add country</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">Postal code</label>
                  <input class="form-control" type="text" id="address-zip" name="postal_code"  required>
                  <div class="invalid-feedback">Please add your Postal code!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">Phone No</label>
                  <input class="form-control" type="text" id="address-zip" name="mobile" required>
                  <div class="invalid-feedback">Please add your mobile no!</div>
                </div>
               
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary btn-shadow" type="submit">Add address</button>
            </div>
          </div>
        </div>
      </form>
      <!-- Navbar 3 Level (Light)-->
      
      {% for a in address %}
      <form class="needs-validation modal fade" id="update-address-{{forloop.counter}}" action="{% url 'edit_customer_address' a.id %}" method="POST" tabindex="-1" novalidate>
     
        {% csrf_token %}
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add a new address</h5>
              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row gx-4 gy-3">
                <div class="col-sm-6">
                  <label class="form-label" for="address-fn">First name</label>
                  <input class="form-control" type="text" id="address-fn" name="first_name" value={{a.first_name}} required >
                  <div class="invalid-feedback">Please fill in you first name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-fn">Last name</label>
                  <input class="form-control" type="text" id="address-fn" name="last_name" value={{a.last_name}} required >
                  <div class="invalid-feedback">Please fill in you last name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-line1">Address Line 1</label>
                  <input class="form-control" type="text" id="address-line1" name="address_line_1" value="{{a.address_line_1}}" required>
                  <div class="invalid-feedback">Please fill in your address!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-line2">Unit No</label>
                  <input class="form-control" type="text" id="address-line2" value= "{{a.unit_no}}" name="unit_no">
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">Country</label>
                  <input class="form-control" type="text" id="address-country" name="country"  value="{{a.country}}" required>
                  <div class="invalid-feedback">Please add country</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">Postal code</label>
                  <input class="form-control" type="text" id="address-zip" name="postal_code"  value= {{a.postal_code}} required>
                  <div class="invalid-feedback">Please add your Postal code!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">Phone No</label>
                  <input class="form-control" type="text" id="address-zip" name="mobile" value="{{a.mobile}}" required>
                  <div class="invalid-feedback">Please add your mobile no!</div>
                </div>
               
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary btn-shadow" type="submit">Update address</button>
            </div>
          </div>
        </div>
      </form>
      {% endfor %}
      <!-- Page Title-->
      <div class="page-title-overlap bg-dark pt-4">
        <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
          <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-light flex-lg-nowrap justify-content-center justify-content-lg-start">
                <li class="breadcrumb-item"><a class="text-nowrap" href="index.html"><i class="ci-home"></i>Home</a></li>
                <li class="breadcrumb-item text-nowrap"><a href="#">Account</a>
                </li>
                <li class="breadcrumb-item text-nowrap active" aria-current="page">Addresses</li>
              </ol>
            </nav>
          </div>
          <div class="order-lg-1 pe-lg-4 text-center text-lg-start">
            <h1 class="h3 text-light mb-0">My addresses</h1>
          </div>
        </div>
      </div>
      <div class="container pb-5 mb-2 mb-md-4">
        <div class="row">
          <!-- Sidebar-->
        {% include 'includes/c_sidebar.html' %}
          <!-- Content  -->
          <section class="col-lg-8">

           
            <!-- Toolbar-->
            <div class="d-none d-lg-flex justify-content-between align-items-center pt-lg-3 pb-4 pb-lg-5 mb-lg-3">
              <h6 class="fs-base text-light mb-0">List of your registered addresses:</h6><a class="btn btn-primary btn-sm" href="{% url 'logout' %}"><i class="ci-sign-out me-2"></i>Sign out</a>
            </div>
            <form action="#" method="POST" >
               
                <div class="text-sm-end pt-4"><a class="btn btn-primary post_details-btn" href="#add-address"  data-bs-toggle="modal">Add new address</a></div>
                  
               
            </form>
            <!-- Addresses list-->
            <div class="table-responsive fs-md">
              <h5>Select your default Shipping Address</h5>
              <table class="table table-hover mb-0">
                {% for a in address %}
                <thead>
                  <tr>
                    <th>Address {{forloop.counter}}</th>
                  </tr>
                </thead>
                <tbody>
                  
                  <tr>
                    <td class="py-3 align-middle">
                        <address>
                          <div class="col-sm-12">
                            <ul class="list-unstyled fs-sm">
                              <li><span class="text-muted">Name:&nbsp;</span>{{a.full_name}}</li>
                              <li><span class="text-muted">Address:&nbsp;</span>{{a.unit_no}}, {{a.address_line_1}}</li>
                              <li><span class="text-muted">Pin Code:&nbsp;</span>{{a.postal_code}}</li>
                              <li><span class="text-muted">Phone:&nbsp;</span> {{a.mobile}}</li>
                            </ul>
                          </div>
                         </address>
                         {% if a.status %}
                        
                         <i data-address-id="{{a.id}}" class="ci-check-circle text-success me-2 check{{a.id}} check"></i>
                         <button data-address-id="{{a.id}}"  style="display: None;" class="btn btn-primary make-default-address button{{a.id}} action_btn">Default Address</button>
                         {% else %}
                         
                         <i data-address-id="{{a.id}}" style="display: None;" class="ci-check-circle text-success me-2 check check{{a.id}} "></i>
                         <button data-address-id="{{a.id}}"  class="btn btn-primary make-default-address button{{a.id}} action_btn" data-bs-toggle="tooltip" title="Make default">Default Address</button>
                         {% endif %}

                        
                       

                        &nbsp;&nbsp;
                       <a href="{% url 'delete_customer_address' a.id %}" onclick="return confirm('Are you sure you want to delete this address?')"><button class="btn bg-faded-danger btn-icon" type="button" data-bs-toggle="tooltip" title="Delete address"><i class="ci-trash text-danger"></i></button></a>
                       &nbsp;&nbsp;              
                       <!-- <form action="#" method="POST" > -->
               
                        <a href="#update-address-{{forloop.counter}}"  data-bs-toggle="modal"><button class="btn bg-faded-info btn-icon me-2" type="button" data-bs-toggle="tooltip" title="Edit Address"><i class="ci-edit text-info"></i></button></a>
                    
                       
                    <!-- </form> -->
                    </td>
                    
                  </tr>
                  {% endfor %}
                
                </tbody>
              </table>
            </div>
           
          </section>
        </div>
      </div>
      {% if user.is_authenticated %}
{% include 'chat/partials/chat_bubble.html' %}
{% endif %}
<script src="{% static 'js/main.js' %}"></script>
    </main>
    <!-- Footer-->
  

  </body>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    //making default address
    $(document).on("click",".make-default-address",function(){
        let id = $(this).attr("data-address-id")
        let this_val = $(this)

        console.log("ID is :",id);
        console.log("Element is :",this_val)

        $.ajax({
            url:"{% url 'make_address_default' %}",
            data:{
                "id":id
            } ,
            dataType:'json',		
            success:function(res){
                console.log("Address made default...   ")
                if(res.boolean == true){
                    $(".check").hide()
                    $(".action_btn").show()

                    $(".check"+id).show()
                    $(".button"+id).hide()
                }
                
            }
        });
    })
</script>


{% endblock %}